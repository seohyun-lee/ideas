name: Deploy to GitHub Pages

on:
  push:
    branches: ["main"]

# GitHub Pages 배포를 위한 권한 설정
permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Inject Firebase Config
        env:
          # GitHub Settings > Secrets에 등록한 'FIREBASE_CONFIG' 값을 가져옵니다.
          FIREBASE_CONFIG: ${{ secrets.FIREBASE_CONFIG }}
        run: |
          # Python 스크립트를 사용하여 HTML 파일 내의 표식(REPLACE_ME...)을 실제 설정값으로 교체합니다.
          python3 -c "
          import os

          target_file = 'index.html'
          placeholder = 'REPLACE_ME_WITH_FIREBASE_CONFIG'
          
          # 환경변수에서 시크릿 값을 가져옵니다.
          secret_config = os.environ.get('FIREBASE_CONFIG', '')

          if secret_config:
              with open(target_file, 'r', encoding='utf-8') as f:
                  content = f.read()

              # 문자열 치환
              new_content = content.replace(placeholder, secret_config)

              with open(target_file, 'w', encoding='utf-8') as f:
                  f.write(new_content)
              print(f'Successfully injected Firebase config into {target_file}')
          else:
              print('Warning: FIREBASE_CONFIG secret is empty or not found.')
          "
          
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          # main 브랜치에 코드를 올리면(Push), 자동으로 이 작업이 실행되어
          # gh-pages 브랜치로 배포됩니다.
